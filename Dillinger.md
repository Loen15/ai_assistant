# Приготовления
## ключ доступа к openAi API  
получите ключ, воспользовавшись любым способом из интернета, например https://dzen.ru/a/ZIcYdIzeGhE3qCJi

## Получить ID и hash аккаунта для telegram
1. Создать новый аккаунт в телеге 
>нужна физическая симка так как в процессе работы бота возможно понадобиться восстанавливать доступ к аккаунту
2. Зайти на https://my.telegram.org/auth
3. следовать инструкции https://lavhost.su/telegram-api

## прокси 
купите прокси 
>например здесь https://proxy6.net/

>Необходим proxy IPv4 страны, в которой openAI работает 
>вот список стран https://beta.openai.com/docs/supported-countries
## Настройка окружения
- зарегестрироваться в github.com и установить git (https://git-scm.com/download/win)
- установить VS code 
>или любой другой редактор кода, но дальше я буду описывать работу с ним
- скачать python (качаем с https://www.python.org/downloads/)
 - Настроить виртуальное окружение (https://semakin.dev/2020/04/python_virtualenv/) 
    >  можно пропустить, обычно это делается если проект не один, чтобы не путались библиотеки 
- Скачать необходимые библиотеки введя в консоль: `pip install -U pyrogram requests apscheduler`

# Переходим к коду
- создайте репозиторий на github
- создайте в удобном для вас месте папку
-  вызовите контекстное меню нажав правой кнопкой мыши по папке и выберите `Открыть с помощью Code`
- нажав клавиши `Ctrl+ё` вызовите терминал
  > убедитесь что находитесь в папке проекта, если это не так, то в консоль `cd C://<Путь к проекту>`
- напишите в терминале `git clone <ссылка на Ваш репозиторий>`
- создайте новый файл, назвав его `.gitignore` и впишите в него 
```sh
secret_constants.py
```
> в этом файле прописываются названия файлов, которые не будут отправляться в репозиторий на гитхаб

- создайте новый файл `secret_constants.py` и напишите в него
```py
api_id = <id для telegram из пункта выше>
api_hash = '<hash для telegram из пункта выше>'
proxy = 'http://<user>:<pass>@<ip>:<port>' # данные вашей прокси
openai_key = '<ключ доступа к GPT>'
self_id = <id аккаунта куда бот будет писать о принятии заявок или об ошибках>
```
> Вставьте ваши значения в  <_>
___
описание кода будет явно позже
___
- запустите бота и протестируйте, если все работает, переходим на следующий шаг

# Деплой
Сейчас бот работает только когда у Вас включено приложение и есть доступ к интернету, для его работы в автономном режиме необходимо его задеплоить на сервер

#### Сначала подготовим код 
- теперь все переменные, которые мы обьявляли в файле `secret_constants.py` надо чтобы программа загружала из окружения, для этого удаляем из файлов кода строку `from secret_constants import ...` и пишем `import os`
- для каждой секретной переменной пишем  `api_id = int(os.environ['API_ID'])` если значение численное, и `api_hash = os.environ['API_HASH']` если значение содержит буквы
> названия берем из строки `from secret_constants import ...`, а в скобках `['..']` пишет то же самое капсом


### далее идет git
- нажав клавиши `Ctrl+ё` вызовите терминал
> убедитесь что находитесь в папке проекта, если это не так, то в консоль `cd C://<Путь к проекту>`
- пропишите в терминал по очереди
```sh
git add .
git commit -m "<коментарий>"
git push
```
> в последнем случае в терминале напишется команда которую надо написать вместо `git push`

- далее если все верно, то на гитхабе в вашем репозитории появятся Ваши файлы, кроме тех, что указаны в `.gitignore`

### переходим к серверу
Теперь необходимо купить сервер, на котором у Вас будет работать этот код
> я использовал https://ruvds.com/ 
 Выбрал там шаблон `Docker CE - Ubuntu 18.04`  с минимальным железом

Далее по полученным данным сервера подключитесь к нему введя в консоль 
```sh
ssh <user>@<ip-адресс>
``` 
и введите пароль
Далее клонируйте Ваш проект, вписав `git clone <ссылка на Ваш репозиторий>`
и зайдите в папку с ним, написав `cd <название репозитория>`
>Чтобы создать файл в консоли и вписать в него что-то, нужно ввести `cat>название_файла` и вводить построчно содержание файла

Теперь создайте файл Dockerfile и впишите в него следующее
```docker
FROM python:3.10.0

WORKDIR /
COPY ./ .

RUN apt update
RUN pip install --upgrade pip pyrogram requests tgcrypto apscheduler

ENV API_ID=123 API_HASH=d1d2d3 SELF_ID=321 PROXY=http://... OPENAI_KEY=sk-sq1... TZ=Europe/Moscow

ENTRYPOINT ["python", "main.py"]
```
> В строке с ENV введите необходимые значения
теперь соберите образ для Docker вписав в консоль 
```
docker build -t <любое_название> .
```
и соберите контейнер введя 
```
docker run -it --restart=unless-stopped <название_образа>
```
Пройдите авторизацию и после чего можете закрывать консоль, все будет работать в автономном режиме
> для более безопасного хранения данных на сервере воспользуйтесь этим руководством https://timeweb.com/ru/community/articles/kak-podklyuchitsya-k-serveru-cherez-ssh-po-parolyu-ili-klyuchu 

